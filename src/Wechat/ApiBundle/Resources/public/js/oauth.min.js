var oauthjs={ajaxloadlist:function(){popup.openloading(),$.ajax({url:"/wechat/oauth/list",type:"post",dataType:"json",success:function(a){popup.closeloading(),"10"==a.code&&oauthjs.buildlist(a.list),popup.openwarning(a.msg)},error:function(){popup.closeloading(),popup.openwarning("unknow error")}})},buildlisttable:null,buildlist:function(a){this.buildlisttable&&this.buildlisttable.destroy(),$("#oauthlisttable tbody").empty(),this.buildlisttable=$("#oauthlisttable").DataTable({data:a,columns:[{data:"name"},{class:"oauthcss",data:"redirect_url"},{data:"scope",class:"t-center"},{data:"oauthfile",render:function(a,t,o){return a?'<a target="_blank" href="/wechat/oauth/vendor/'+a+'">'+pagecode.hosts+"/wechat/oauth/vendor/"+a+"</a>":""}},{class:"t-center",data:null,defaultContent:'<i class="fa fa-edit fa-lg"></i>'},{class:"t-center",data:null,defaultContent:'<i class="fa fa-trash-o fa-lg"></i>'}],rowCallback:function(a,t){$(a).attr("oauthid",t.id)}})},initadd:function(){$("#addoauth .oauthredirect").val(""),$("#addoauth .oauthcallback").val(""),$("#addoauth .oauthname").val("")},ajaxadd:function(){popup.openloading(),$.ajax({url:"/wechat/oauth/add",type:"post",data:{redirect_url:$("#addoauth .oauthredirect").val(),callback_url:$("#addoauth .oauthcallback").val(),name:$("#addoauth .oauthname").val(),scope:$("#addoauth .oauthscope").val()},dataType:"json",success:function(a){popup.closeloading(),"10"==a.code&&(oauthjs.ajaxloadlist(),publicall.gotolist(),oauthjs.initadd()),popup.openwarning(a.msg)},error:function(){popup.closeloading(),popup.openwarning("unknow error")}})},ajaxeditid:null,ajaxinfo:function(){var a=this;popup.openloading(),$.ajax({url:"/wechat/oauth/info",type:"post",data:{id:a.ajaxeditid},dataType:"json",success:function(a){popup.closeloading(),"10"==a.code&&($("#editoauth .oauthredirect").val(a.info.redirect_url),$("#editoauth .oauthcallback").val(a.info.callback_url),$("#editoauth .oauthname").val(a.info.name),$("#editoauth .oauthscope").val(a.info.scope),publicall.gotoedit("editoauth")),popup.openwarning(a.msg)},error:function(){popup.closeloading(),popup.openwarning("unknow error")}})},ajaxupdate:function(){var a=this;popup.openloading(),$.ajax({url:"/wechat/oauth/update",type:"post",data:{id:a.ajaxeditid,redirect_url:$("#editoauth .oauthredirect").val(),callback_url:$("#editoauth .oauthcallback").val(),name:$("#editoauth .oauthname").val(),scope:$("#editoauth .oauthscope").val()},dataType:"json",success:function(a){popup.closeloading(),"10"==a.code&&(oauthjs.ajaxloadlist(),publicall.gotolist()),popup.openwarning(a.msg)},error:function(){popup.closeloading(),popup.openwarning("unknow error")}})},ajaxdelete:function(a){popup.openloading(),$.ajax({url:"/wechat/oauth/delete",type:"post",data:{id:a},dataType:"json",success:function(a){popup.closeloading(),"10"==a.code&&oauthjs.ajaxloadlist(),popup.openwarning(a.msg)},error:function(){popup.closeloading(),popup.openwarning("unknow error")}})},onload:function(){var a=this;$("#addoauthsubmit").click(function(){a.ajaxadd()}),$("#oauthlist").on("click","#oauthlisttable .fa-edit",function(){a.ajaxeditid=$(this).parent().parent().attr("oauthid"),a.ajaxinfo()}),$("#oauthlist").on("click","#oauthlisttable .fa-trash-o",function(){a.ajaxdelete($(this).parent().parent().attr("oauthid"))}),$("#editoauth").on("click","#editoauthsubmit",function(){a.ajaxupdate()}),$("#editoauth").on("click",".fa-mail-reply",function(){publicall.gotolist()})}};$(function(){oauthjs.onload()});