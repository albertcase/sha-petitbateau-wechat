var mytipsbox={tipboxobj:null,tipboxcontent:function(i){var t=window.location.protocol+"//"+window.location.host,o="";o+='<div class="tipnews" style="z-index:99">',o+="<div>",o+="<div>",o+="<ul>";for(var e=i.length,n=0;n<e;n++)o+='<li nid="'+i[n].id+'" digest="'+i[n].digest+'">',o+="<p>"+i[n].title+"</p>",o+='<img src="'+t+"/cimg.php?style=w_800&image="+encodeURIComponent(i[n].thumb_url)+'">',o+='<a href="javascrpt::void()#" class="tip-newa" onurl="'+i[n].url+'">点击添加</a>',o+="</li>";o+="</ul>",o+="</div>",o+="</div>",o+="</div>",mytipsbox.tipboxobj.html(o),mytipsbox.tipboxobj[0].scrollTop=0,mytipsbox.traggletipbox(),mytipsbox.tipboxobj.show()},insertnewsP:null,ajaxloadlist:function(){popup.openloading(),$.ajax({url:"/wechat/materiallist",type:"post",dataType:"json",success:function(i){popup.closeloading(),"10"==i.code&&mytipsbox.tipboxcontent(i.list),popup.openwarning(i.msg)},error:function(){popup.closeloading(),popup.openwarning("unknow error")}})},selecttipbox:function(){var i=this;if(mytipsbox.tipboxobj)return i.traggletipbox(),mytipsbox.tipboxobj;var t='<div class="wehchat-mytips" style="display:none"></div>';return mytipsbox.tipboxobj=$(t),this.ajaxloadlist(),mytipsbox.tipboxobj},traggletipbox:function(){var i=this;mytipsbox.tipboxobj.toggle(),mytipsbox.insertnewsP.children("span").children(".wehchat-mytips").length||(mytipsbox.insertnewsP.children("span").append(mytipsbox.tipboxobj),mytipsbox.tipboxobj.find(".tip-newa").each(function(){$(this).click(function(i){if(mytipsbox.insertnewsP){var t=$(this).parent(),o={Title:t.children("p").text(),Description:t.attr("digest"),Url:t.children("a").attr("onurl"),PicUrl:t.children("img").attr("src")};mytipsbox.insertnewsP.after(htmlconetnt.loadpushmessage(o)),mytipsbox.insertnewsP.prev().remove(),mytipsbox.insertnewsP.remove(),mytipsbox.tipboxobj.hide()}i.stopPropagation()})})),clearTimeout(i.autoclose),i.autoclose=setTimeout(function(){i.tipboxobj.hide()},2e3),i.addlistener()},autoclose:null,ajaxgetnewtip:function(i,t,o){$.ajax({url:"/wechat/materiallist",type:"post",dataType:"json",data:{id:i,order:t},controlobj:o,success:function(i){"10"==i.code&&mytipsbox.insertnewsli(i.list,this.controlobj),popup.openwarning(i.msg)},error:function(){popup.openwarning("unknow error"),this.controlobj.slideUp("show","linear",function(){$(this).remove()})}})},insertnewsli:function(i,t){var o=window.location.protocol+"//"+window.location.host,e=i.length;e>0&&t.hide();for(var n=0;n<e;n++){$val='<li nid="'+i[n].id+'" digest="'+i[n].digest+'">',$val+="<p>"+i[n].title+"</p>",$val+='<img src="'+o+"/cimg.php?style=w_800&image="+encodeURIComponent(i[n].thumb_url)+'">',$val+='<a href="javascrpt::void()#" class="tip-newa" onurl="'+i[n].url+'">点击添加</a>',$val+="</li>";var s=$($val);s.click(function(){if(mytipsbox.insertnewsP){var i=$(this),t={Title:i.children("p").text(),Description:i.attr("digest"),Url:i.children("a").attr("onurl"),PicUrl:i.children("img").attr("src")};mytipsbox.insertnewsP.after(htmlconetnt.loadpushmessage(t)),mytipsbox.insertnewsP.prev().remove(),mytipsbox.insertnewsP.remove(),mytipsbox.tipboxobj.hide()}}),t.before(s)}t.slideUp("show","linear",function(){$(this).remove()})},addlistener:function(){var i=this;i.tipboxobj[0].addEventListener("mouseenter",function(){clearTimeout(i.autoclose)}),i.tipboxobj[0].addEventListener("wheel",function(i){if(i.wheelDelta){var t=mytipsbox.tipboxobj.children("div").children("div")[0].scrollTop,o=mytipsbox.tipboxobj.children("div").children("div")[0].scrollHeight-mytipsbox.tipboxobj.children("div").children("div")[0].offsetHeight;if(i.wheelDelta>0&&0==t&&!mytipsbox.tipboxobj.find("ul>li").eq(0).is(".tiploading")){var e=$(mytipsbox.addloadbox());mytipsbox.ajaxgetnewtip(mytipsbox.tipboxobj.find("ul>li").eq(0).attr("nid"),"top",e),mytipsbox.tipboxobj.find("ul").prepend(e),e.slideDown()}if(i.wheelDelta<0&&t==o&&!mytipsbox.tipboxobj.find("ul>li").last().is(".tiploading")){var e=$(mytipsbox.addloadbox());mytipsbox.ajaxgetnewtip(mytipsbox.tipboxobj.find("ul>li").last().attr("nid"),"bottom",e),mytipsbox.tipboxobj.find("ul").append(e),e.slideDown()}}else i.detail&&(i.detail>0&&console.log("滑轮向上滚动"),i.detail<0&&console.log("滑轮向下滚动"));i.stopPropagation()});var t=function(){mytipsbox.tipboxobj.hide(),document.removeEventListener("click",t)};document.addEventListener("click",t)},addloadbox:function(){var i="";return i+='<li class="tiploading" style="display:none">',i+='<i class="fa fa-spinner fa-spin"></i>',i+="</li>"},onload:function(){}};$(function(){mytipsbox.onload()});