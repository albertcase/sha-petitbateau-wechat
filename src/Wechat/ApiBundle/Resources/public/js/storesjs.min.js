var stores={ajaxloadlist:function(){popup.openloading(),$.ajax({url:"/wechat/stores/list",type:"post",dataType:"json",success:function(e){popup.closeloading(),"10"==e.code&&stores.buildlist(e.list),popup.openwarning(e.msg)},error:function(){popup.closeloading(),popup.openwarning("unknow error")}})},buildlisttable:null,buildlist:function(e){this.buildlisttable&&this.buildlisttable.destroy(),$("#storeslisttable tbody").empty(),this.buildlisttable=$("#storeslisttable").DataTable({data:e,columns:[{data:"storename",class:"t-center"},{class:"t-center",data:"phone"},{data:"brandtype",class:"t-center"},{data:"storelog",render:function(e,t,s){return e?"<img src='"+e+"'/ style='width:120px'>":""}},{class:"t-center",data:null,defaultContent:'<i class="fa fa-edit fa-lg"></i>'},{class:"t-center",data:null,defaultContent:'<i class="fa fa-trash-o fa-lg"></i>'}],rowCallback:function(e,t){$(e).attr("storeid",t.id)}})},ajaxadd:function(){popup.openloading(),$.ajax({url:"/wechat/stores/add",type:"post",data:{storename:$("#addstores .storename").val(),address:$("#addstores .storeaddress").val(),phone:$("#addstores .storephone").val(),lat:$("#addstores .storelat").val(),lng:$("#addstores .storelng").val(),openhours:$("#addstores .storeopenhours").val(),brandtype:$("#addstores .storebrandtype").val(),storelog:$("#addstores .newspic").attr("src")},dataType:"json",success:function(e){popup.closeloading(),"10"==e.code&&(stores.ajaxloadlist(),publicall.gotolist(),stores.initaddbox()),popup.openwarning(e.msg)},error:function(){popup.closeloading(),popup.openwarning("unknow error")}})},initaddbox:function(){$("#addstores .storename").val(""),$("#addstores .storeaddress").val(""),$("#addstores .storephone").val(""),$("#addstores .storelat").val(""),$("#addstores .storelng").val(""),$("#addstores .storeopenhours").val(""),$("#addstores .storebrandtype").val(""),$("#addstores .newspic").length&&fileupload.replaceimage($("#addstores .newspic").prev()),$("#addstores .newsfile").length&&$("#addstores .newsfile").val("")},initeditbox:function(){$("#editstores .storename").val(""),$("#editstores .storeaddress").val(""),$("#editstores .storephone").val(""),$("#editstores .storelat").val(""),$("#editstores .storelng").val(""),$("#editstores .storeopenhours").val(""),$("#editstores .storebrandtype").val(""),$("#editstores .newspic").length&&fileupload.replaceimage($("#editstores .newspic").prev()),$("#editstores .newsfile").length&&$("#editstores .newsfile").val("")},ajaxeditid:null,ajaxinfo:function(){var e=this;popup.openloading(),$.ajax({url:"/wechat/stores/info",type:"post",data:{id:e.ajaxeditid},dataType:"json",success:function(e){popup.closeloading(),"10"==e.code&&($("#editstores .storename").val(e.info.storename),$("#editstores .storeaddress").val(e.info.address),$("#editstores .storephone").val(e.info.phone),$("#editstores .storelat").val(e.info.lat),$("#editstores .storelng").val(e.info.lng),$("#editstores .storeopenhours").val(e.info.openhours),$("#editstores .storebrandtype").val(e.info.brandtype),fileupload.replaceinput(e.info.storelog,$("#editstores .newsfile")),publicall.gotoedit("editstores")),popup.openwarning(e.msg)},error:function(){popup.closeloading(),popup.openwarning("unknow error")}})},ajaxupdate:function(){var e=this;popup.openloading(),$.ajax({url:"/wechat/stores/update",type:"post",data:{id:e.ajaxeditid,storename:$("#editstores .storename").val(),address:$("#editstores .storeaddress").val(),phone:$("#editstores .storephone").val(),lat:$("#editstores .storelat").val(),lng:$("#editstores .storelng").val(),openhours:$("#editstores .storeopenhours").val(),brandtype:$("#editstores .storebrandtype").val(),storelog:$("#editstores .newspic").attr("src")},dataType:"json",success:function(e){popup.closeloading(),"10"==e.code&&(stores.ajaxloadlist(),publicall.gotolist()),popup.openwarning(e.msg)},error:function(){popup.closeloading(),popup.openwarning("unknow error")}})},ajaxdelete:function(e){popup.openloading(),$.ajax({url:"/wechat/stores/delete",type:"post",data:{id:e},dataType:"json",success:function(e){popup.closeloading(),"10"==e.code&&stores.ajaxloadlist(),popup.openwarning(e.msg)},error:function(){popup.closeloading(),popup.openwarning("unknow error")}})},onload:function(){var e=this;$("#addstores").on("change",".newsfile",function(){fileupload.sendfiles($(this)[0].files[0],$(this))}),$("#editstores").on("change",".newsfile",function(){fileupload.sendfiles($(this)[0].files[0],$(this))}),$("#editstores").on("click",".fa-times",function(){fileupload.replaceimage($(this))}),$("#addstores").on("click",".fa-times",function(){fileupload.replaceimage($(this))}),$("#addstoressubmit").on("click",function(){e.ajaxadd()}),$("#storeslist").on("click","#storeslisttable .fa-edit",function(){e.ajaxeditid=$(this).parent().parent().attr("storeid"),e.ajaxinfo()}),$("#editstores").on("click",".fa-mail-reply",function(){e.ajaxloadlist()}),$("#editstoresubmit").on("click",function(){e.ajaxupdate()}),$("#storeslist").on("click","#storeslisttable .fa-trash-o",function(){console.log($(this).parent().parent().attr("storeid")),e.ajaxdelete($(this).parent().parent().attr("storeid"))})}};$(function(){stores.onload()});