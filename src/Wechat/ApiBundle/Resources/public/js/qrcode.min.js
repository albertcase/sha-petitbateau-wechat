var qrcode={ajaxloadlist:function(){popup.openloading(),$.ajax({url:"/wechat/qrcode/list",type:"post",dataType:"json",success:function(e){popup.closeloading(),"10"==e.code&&qrcode.buildlist(e.list),popup.openwarning(e.msg)},error:function(){popup.closeloading(),popup.openwarning("unknow error")}})},ajaxaddqrcode:function(){var e=this,t=e[e.aMessageFun]();popup.openloading(),$.ajax({url:"/wechat/qrcode/add",type:"post",dataType:"json",data:t,success:function(e){popup.closeloading(),"10"==e.code&&(qrcode.ajaxloadlist(),publicall.gotolist(),publicall.emptyactive("addqrcode"),qrcode.aMessageFun="anone",$("#addqrcode .qrcodename").val(""),$("#addqrcode .qrcodeid").val("")),popup.openwarning(e.msg)},error:function(){popup.closeloading(),popup.openwarning("unknow error")}})},buildlisttable:null,buildlist:function(e){this.buildlisttable&&this.buildlisttable.destroy(),$("#qrcodelisttable tbody").empty(),this.buildlisttable=$("#qrcodelisttable").DataTable({data:e,columns:[{data:"qrName",class:"t-center"},{class:"t-center",data:"qrSceneid"},{data:"qrScan",class:"t-center"},{data:"qrSubscribe",class:"t-center"},{data:"qrTicket",render:function(e,t,a){return e?"<img src='https://mp.weixin.qq.com/cgi-bin/showqrcode?ticket="+e+"'/ style='width:110px'>":""}},{class:"t-center",data:null,defaultContent:'<i class="fa fa-edit fa-lg"></i>'},{class:"t-center",data:null,defaultContent:'<i class="fa fa-trash-o fa-lg"></i>'}],rowCallback:function(e,t){$(e).attr("qrid",t.id)}})},aMessageFun:"anone",anone:function(){var e={qrName:$("#addqrcode .qrcodename").val(),qrSceneid:$("#addqrcode .qrcodeid").val()};return e},apushmessage:function(){var e={qrName:$("#addqrcode .qrcodename").val(),qrSceneid:$("#addqrcode .qrcodeid").val(),MsgType:"news",newslist:menu.getnewslist($("#addqrcode .pushmessage .newslist"))};return e},atextmessage:function(){var e={qrName:$("#addqrcode .qrcodename").val(),qrSceneid:$("#addqrcode .qrcodeid").val(),MsgType:"text",Content:$("#addqrcode .textcontent").val()};return e},getnewslist:function(e){var t=[];e.length;return e.each(function(){var e=$(this),a={};a={Title:e.find(".newstitle").val(),Description:e.find(".newsdescription").val(),Url:e.find(".newslink").val(),PicUrl:e.find(".newspic").attr("src")},t.push(a)}),JSON.stringify(t)},ajaxeditid:null,ajaxinfo:function(){var e=this;popup.openloading(),$.ajax({url:"/wechat/qrcode/info",type:"post",data:{id:e.ajaxeditid},dataType:"json",success:function(e){popup.closeloading(),"10"==e.code&&(qrcode.buildinfo(e.info),publicall.gotoedit("editqrcode")),popup.openwarning(e.msg)},error:function(){popup.closeloading(),popup.openwarning("unknow error")}})},editid:null,buildinfo:function(e){var t=this;return publicall.emptyactive("editqrcode"),$("#editqrcode .qrcodename").val(e.qrName),"text"==e.MsgType?($("#editqrcode .buttontype .btn").eq(0).addClass("active"),$("#editqrcode .textmessage").addClass("menushow"),t.updateFun="etextmessage",$("#editqrcode .textmessage").html(htmlconetnt.atextmessage(e.Content)),!0):"news"==e.MsgType?($("#editqrcode .buttontype .btn").eq(1).addClass("active"),$("#editqrcode .pushmessage").addClass("menushow"),t.updateFun="epushmessage",$("#editqrcode .pushmessage").html(htmlconetnt.apushmessage(e.newslist)),!0):($("#editqrcode .buttontype .btn").eq(2).addClass("active"),void(t.updateFun="enone"))},updateFun:"none",ajaxupdateqrcode:function(){var e=this,t=e[e.updateFun]();popup.openloading(),$.ajax({url:"/wechat/qrcode/update",type:"post",dataType:"json",data:t,success:function(e){popup.closeloading(),"10"==e.code&&(qrcode.ajaxloadlist(),publicall.gotolist()),popup.openwarning(e.msg)},error:function(){popup.closeloading(),popup.openwarning("unknow error")}})},enone:function(){var e=this,t={id:e.ajaxeditid,qrName:$("#editqrcode .qrcodename").val()};return t},epushmessage:function(){var e=this,t={id:e.ajaxeditid,qrName:$("#editqrcode .qrcodename").val(),MsgType:"news",newslist:menu.getnewslist($("#editqrcode .pushmessage .newslist"))};return t},etextmessage:function(){var e=this,t={id:e.ajaxeditid,qrName:$("#editqrcode .qrcodename").val(),MsgType:"text",Content:$("#editqrcode .textcontent").val()};return t},ajaxdelete:function(e){popup.openloading(),$.ajax({url:"/wechat/qrcode/delete",type:"post",dataType:"json",data:{id:e},success:function(e){popup.closeloading(),"10"==e.code&&(qrcode.ajaxloadlist(),publicall.gotolist()),popup.openwarning(e.msg)},error:function(){popup.closeloading(),popup.openwarning("unknow error")}})},onload:function(){var e=this;$("#addqrcodesubmit").click(function(){e.ajaxaddqrcode()}),$("#addqrcode").on("click",".buttontype>.btn-default",function(){e.aMessageFun="a"+$(this).attr("action"),publicall.activemenu("addqrcode",$(this))}),$("#addqrcode").on("change",".newsfile",function(){fileupload.sendfiles($(this)[0].files[0],$(this))}),$("#addqrcode").on("click",".fa-times",function(){fileupload.replaceimage($(this))}),$("#addqrcode").on("click",".fa-plus-square",function(){var e=htmlconetnt.addnewshtml();$(this).after(e),$(this).remove(),$("#addqrcode .pushmessage .fa-minus-square").length>=10&&$("#addqrcode .pushmessage .fa-plus-square").remove()}),$("#addqrcode").on("click",".fa-minus-square",function(){$(this).parent().remove()}),$("#editqrcode").on("change",".newsfile",function(){fileupload.sendfiles($(this)[0].files[0],$(this))}),$("#editqrcode").on("click",".fa-times",function(){fileupload.replaceimage($(this))}),$("#editqrcode").on("click",".fa-plus-square",function(){var e=htmlconetnt.addnewshtml();$(this).after(e),$(this).remove(),$("#editqrcode .pushmessage .fa-minus-square").length>=10&&$("#editqrcode .pushmessage .fa-plus-square").remove()}),$("#editqrcode").on("click",".fa-minus-square",function(){$(this).parent().remove()}),$("#editqrcode").on("click",".buttontype>.btn-default",function(){e.updateFun="e"+$(this).attr("action"),publicall.activemenu("editqrcode",$(this))}),$("#qrcodelist").on("click","#qrcodelisttable .fa-edit",function(){e.ajaxeditid=$(this).parent().parent().attr("qrid"),e.ajaxinfo()}),$("#qrcodelist").on("click","#qrcodelisttable .fa-trash-o",function(){e.ajaxdelete($(this).parent().parent().attr("qrid"))}),$("#editqrcode").on("click","#editqrcodesubmit",function(){e.ajaxupdateqrcode()}),$("#editqrcode").on("click",".fa-mail-reply",function(){publicall.gotolist()})}};$(function(){qrcode.onload()});